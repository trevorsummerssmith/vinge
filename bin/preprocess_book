#!/usr/bin/env python

import sys
from vinge.books_backend import clean_up_word

bookfile = open(sys.argv[1], 'r')
proper_name_file = open(sys.argv[2], 'w')

word_freqs = {}
lword_freqs = {}
tword_freqs = {}
for line in bookfile:
    for word in line.split():
        word = clean_up_word(word)
        lword = word.lower()
        tword = word.title()

        freq = word_freqs.get(word, 0)
        lfreq = lword_freqs.get(lword, 0)
        tfreq = tword_freqs.get(tword, 0)

        word_freqs[word] = freq + 1
        if word == lword:
            lword_freqs[lword] = freq + 1
        if word == tword:
            tword_freqs[tword] = freq + 1


bookfile.close()

words = sorted(word_freqs.keys(), key=lambda w: lword_freqs.get(w.lower(), 0))[::-1]
nwords = len(words)

for rank, word in enumerate(words): 
    freq  = word_freqs[word]
    lfreq = lword_freqs.get(word.lower(), 0)
    tfreq = tword_freqs.get(word.title(), 0)

    str_freq  = str(freq).rjust(5)
    str_lfreq = str(lfreq).rjust(5)
    str_tfreq = str(tfreq).rjust(5)

    print str(rank).rjust(5), word.ljust(30), str_freq, str_lfreq, str_tfreq,
    if 0.1 * tfreq > 0.9 * lfreq and len(word) > 1:
        print 'PROPER'
        proper_name_file.write(word.title() + '\n')
    else:
        print

proper_name_file.close()
